{
  "id": "cf-similar-items-rec",
  "stages": [
    {
      "type": "sub-query",
      "id": "zxzdunmi",
      "key": "topusers",
      "collection": "lucidfind_signals_aggr",
      "handler": "select",
      "method": "GET",
      "parentParams": [
        "threadId",
        "subjectSimple"
      ],
      "rollupKeys": [],
      "params": [
        {
          "key": "fl",
          "value": "from_email_s,weight_d"
        },
        {
          "key": "qf",
          "value": "threadId_s,subject_simple_s"
        },
        {
          "key": "defType",
          "value": "edismax"
        },
        {
          "key": "rows",
          "value": "100"
        },
        {
          "key": "sort",
          "value": "weight_d desc"
        },
        {
          "key": "q",
          "value": "{!lucene q.op=OR}{!edismax qf='threadId_s' v=$threadId} {!edismax qf='subject_simple_s' v=$subjectSimple}"
        }
      ],
      "headers": [],
      "skip": false,
      "label": "Get top users for the given thread"
    },
    {
      "type": "query-logging",
      "id": "o45qm2t9",
      "detailed": true,
      "skip": false,
      "label": "query-logging"
    },
    {
      "type": "rollup-rec-aggr",
      "id": "6l1pp66r",
      "key": "topusers",
      "resultKey": "userrollup",
      "rollupField": "from_email_s",
      "weightField": "weight_d",
      "weightFunction": "sum",
      "maxRows": 100,
      "sort": true,
      "skip": true,
      "label": "Rollup on the user ids from sub-query"
    },
    {
      "type": "sub-query",
      "id": "ozrdlsor",
      "key": "subquery-results2",
      "collection": "lucidfind_signals_aggr",
      "handler": "select",
      "method": "GET",
      "parentParams": [],
      "rollupKeys": [
        "userrollup"
      ],
      "params": [
        {
          "key": "q",
          "value": "{!type=edismax qf=from_email_s v=$userrollup}"
        },
        {
          "key": "rows",
          "value": "1000"
        },
        {
          "key": "sort",
          "value": "weight_d desc"
        },
        {
          "key": "fl",
          "value": "*,score"
        }
      ],
      "headers": [],
      "skip": true,
      "label": "sub-query"
    },
    {
      "type": "query-logging",
      "id": "z02rqu8gx8wyd5cdi",
      "detailed": true,
      "skip": true,
      "label": "query-logging"
    },
    {
      "type": "solr-query",
      "id": "7gdkd19lrk7r5dn29",
      "allowedRequestHandlers": [],
      "httpMethod": "POST",
      "allowFederatedSearch": false,
      "skip": true,
      "label": "solr-query"
    }
  ],
  "properties": {}
}