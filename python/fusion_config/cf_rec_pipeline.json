{
  "id": "cf-similar-items-rec",
  "stages": [
    {
      "type": "sub-query",
      "id": "zxzdunmi",
      "key": "topusers",
      "collection": "lucidfind_signals_aggr",
      "handler": "select",
      "method": "GET",
      "parentParams": [
        "threadId",
        "subject_simple"
      ],
      "rollupKeys": [],
      "params": [
        {
          "key": "fl",
          "value": "from_email,weight_d"
        },
        {
          "key": "qf",
          "value": "threadId,subject_simple"
        },
        {
          "key": "defType",
          "value": "edismax"
        },
        {
          "key": "rows",
          "value": "100"
        },
        {
          "key": "sort",
          "value": "weight_d desc"
        }
      ],
      "headers": [],
      "skip": false,
      "label": "Get top users for the given thread"
    },
    {
      "type": "query-logging",
      "id": "o45qm2t9",
      "detailed": true,
      "skip": true,
      "label": "query-logging"
    },
    {
      "type": "rollup-rec-aggr",
      "id": "6l1pp66r",
      "key": "topusers",
      "resultKey": "userrollup",
      "rollupField": "from_email",
      "weightField": "weight_d",
      "weightFunction": "sum",
      "maxRows": 100,
      "sort": true,
      "skip": false,
      "label": "Rollup on the user ids from sub-query"
    },
    {
      "type": "sub-query",
      "id": "ozrdlsor",
      "key": "subquery-results2",
      "collection": "lucidfind_signals_aggr",
      "handler": "select",
      "method": "GET",
      "parentParams": [],
      "rollupKeys": [ "userrollup" ],
      "params": [
        {
          "key": "q",
          "value": "{!type=edismax qf=from_email v=$userrollup}"
        },
        {
          "key": "rows",
          "value": "1000"
        },
        {
          "key": "sort",
          "value": "weight_d desc"
        },
        {
          "key": "fl",
          "value": "query_s,aggr_count_i,weight_d"
        }
      ],
      "headers": [],
      "skip": false,
      "label": "sub-query"
    }
  ],
  "properties": {}
}